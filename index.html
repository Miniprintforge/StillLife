<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiniPrint Forge | Canada Shipping</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://www.paypal.com/sdk/js?client-id=AXoJbHSJNAJ0nV9J2siU7gzFDlO-MEUlxNEb74a9-2-tNRwmwUXMey6AZtuzBrysqRc7XhYSuvFD7blQ&currency=CAD"></script>

    <style>
        :root { --primary: #fbbf24; --bg: #0f172a; --surface: #1e293b; --text: #f8fafc; --muted: #94a3b8; --danger: #ef4444; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; scroll-behavior: smooth; }
        nav { display: flex; justify-content: space-between; align-items: center; padding: 1rem 5%; background: rgba(15, 23, 42, 0.95); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #334155; }
        .logo { font-weight: 800; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; }
        .folder-nav { display: flex; justify-content: center; gap: 10px; padding: 20px; background: #161e2f; overflow-x: auto; border-bottom: 1px solid #334155; }
        .folder-btn { background: var(--surface); border: 1px solid #334155; color: white; padding: 8px 16px; border-radius: 20px; cursor: pointer; white-space: nowrap; }
        .folder-btn.active { background: var(--primary); color: var(--bg); font-weight: bold; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .card { background: var(--surface); border-radius: 12px; padding: 15px; border: 1px solid #334155; text-align: center; }
        .card img { width: 100%; height: 200px; object-fit: cover; border-radius: 8px; }
        .form-section { background: var(--surface); padding: 30px; border-radius: 15px; margin-top: 40px; border: 1px solid #334155; }
        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 6px; border: 1px solid #334155; background: #0f172a; color: white; box-sizing: border-box; }
        .btn { background: var(--primary); color: var(--bg); border: none; padding: 12px; width: 100%; border-radius: 6px; font-weight: 700; cursor: pointer; margin-top: 10px; }
        #cart-sidebar { position: fixed; right: -400px; top: 0; width: 380px; height: 100%; background: var(--surface); transition: 0.3s; z-index: 500; padding: 25px; box-shadow: -10px 0 20px rgba(0,0,0,0.5); overflow-y: auto; }
        #cart-sidebar.active { right: 0; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; background: #0f172a; padding: 10px; border-radius: 8px; margin-bottom: 10px; font-size: 0.85rem; }
        .qty-controls { display: flex; align-items: center; gap: 8px; }
        .qty-btn { background: #334155; color: white; border: none; width: 25px; height: 25px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .remove-link { color: var(--danger); font-size: 0.7rem; cursor: pointer; margin-left: 10px; text-decoration: underline; }
        #checkout-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 1000; overflow-y: auto; }
        .modal-content { background: var(--surface); padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; margin: 20px; }
        .test-btn { background: #10b981; color: white; margin-bottom: 15px; border: 2px dashed #065f46; }
    </style>
</head>
<body>

<nav>
    <div class="logo">MiniPrint Forge</div>
    <div onclick="toggleCart()" style="cursor:pointer; font-weight: bold;">ðŸ›’ Cart (<span id="cart-count">0</span>)</div>
</nav>

<div class="folder-nav" id="folder-container"></div>

<div class="container">
    <div class="grid" id="product-grid"></div>

    <section class="form-section">
        <h2>Custom Print Request</h2>
        <form id="customForm">
            <input type="text" id="custName" placeholder="Name" required>
            <input type="email" id="custEmail" placeholder="Email Address" required>
            <input type="tel" id="custPhone" placeholder="Phone Number" required>
            <select id="custColor">
                <option>Blue</option><option>Yellow</option><option>White</option>
                <option>Black</option><option>Red-Green (Dual)</option><option>Gold-Silver (Dual)</option>
            </select>
            <textarea id="ideaDesc" rows="3" placeholder="Describe your request or paste a file link..."></textarea>
            <button type="button" class="btn" onclick="submitToSheet('Request')">Submit Request</button>
        </form>
    </section>
</div>

<div id="cart-sidebar">
    <h3>Your Order</h3>
    <div id="cart-list"></div>
    <div id="cart-summary" style="margin-top: 20px; border-top: 1px solid #334155; padding-top: 15px;">
        <button class="btn" onclick="openCheckout()">Checkout</button>
        <button class="btn" style="background:transparent; color:white;" onclick="toggleCart()">Close</button>
    </div>
</div>

<div id="checkout-modal">
    <div class="modal-content">
        <h2>Shipping (Canada Only)</h2>
        <select id="shipRegion" onchange="updatePriceDisplay()">
            <option value="12">Ontario ($12.00)</option>
            <option value="14">Quebec ($14.00)</option>
            <option value="18">Western Canada ($18.00)</option>
            <option value="19">Atlantic Canada ($19.00)</option>
            <option value="25">Northern Territories ($25.00)</option>
        </select>
        
        <input type="text" id="shipName" placeholder="Recipient Name">
        <input type="tel" id="shipPhone" placeholder="Phone Number">
        <textarea id="shipAddress" placeholder="Full Street Address, City, Postal Code"></textarea>
        
        <button class="btn test-btn" onclick="submitToSheet('Sale')">ðŸ§ª TEST: Skip PayPal & Buy</button>

        <div style="background: #0f172a; padding: 15px; border-radius: 10px; margin: 15px 0;">
            <div style="display:flex; justify-content:space-between"><span>Subtotal:</span><span id="items-cost">$0.00</span></div>
            <div style="display:flex; justify-content:space-between"><span>Shipping:</span><span id="ship-cost">$0.00</span></div>
            <div style="display:flex; justify-content:space-between; color:var(--primary); font-weight:bold; border-top:1px solid #334155; margin-top:5px; padding-top:5px;">
                <span>Total CAD:</span><span id="final-total">$0.00</span>
            </div>
        </div>

        <div id="paypal-button-container"></div>
        <button class="btn" style="background:transparent; color:white;" onclick="closeCheckout()">Cancel</button>
    </div>
</div>

<script>
    const SHEETDB_URL = 'https://sheetdb.io/api/v1/4zg07pfu42xh5';
    const products = [
        { name: "Phone Stand", price: 10, folder: "Office", img: "https://images.unsplash.com/photo-1586105251261-72a75665786b?q=80&w=400" },
        { name: "Flexy Rex", price: 12, folder: "Toys", img: "https://images.unsplash.com/photo-1581092162384-8987c1d64718?q=80&w=400" },
        { name: "Tool Scraper", price: 8, folder: "Tools", img: "https://images.unsplash.com/photo-1581092921461-7d65507b91d1?q=80&w=400" }
    ];

    let cart = [];

    function init() {
        const folders = ['All', ...new Set(products.map(p => p.folder))];
        document.getElementById('folder-container').innerHTML = folders.map(f => `<button class="folder-btn" onclick="filterFolder('${f}', this)">${f}</button>`).join('');
        renderProducts(products);
        initPayPal();
    }

    function renderProducts(data) {
        document.getElementById('product-grid').innerHTML = data.map(p => `
            <div class="card">
                <img src="${p.img}">
                <h3>${p.name}</h3>
                <span style="color:var(--primary); font-weight:bold">$${p.price.toFixed(2)}</span>
                <select id="color-${p.name.replace(/\s/g, '')}">
                    <option>Blue</option><option>Yellow</option><option>White</option><option>Black</option><option>Red-Green</option><option>Gold-Silver</option>
                </select>
                <button class="btn" onclick="addToCart('${p.name}', ${p.price})">Add to Cart</button>
            </div>
        `).join('');
    }

    function filterFolder(folder, btn) {
        document.querySelectorAll('.folder-btn').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
        const filtered = folder === 'All' ? products : products.filter(p => p.folder === folder);
        renderProducts(filtered);
    }

    function addToCart(name, price) {
        const color = document.getElementById(`color-${name.replace(/\s/g, '')}`).value;
        const existing = cart.find(i => i.name === name && i.color === color);
        if(existing) { existing.qty++; } 
        else { cart.push({ name, price, color, qty: 1 }); }
        updateCartUI();
        if(!document.getElementById('cart-sidebar').classList.contains('active')) toggleCart();
    }

    function changeQty(index, delta) {
        cart[index].qty += delta;
        if(cart[index].qty <= 0) cart.splice(index, 1);
        updateCartUI();
    }

    function updateCartUI() {
        document.getElementById('cart-count').innerText = cart.reduce((sum, i) => sum + i.qty, 0);
        document.getElementById('cart-list').innerHTML = cart.map((item, index) => `
            <div class="cart-item">
                <div style="flex:1">
                    <strong>${item.name}</strong><br><small>${item.color}</small>
                    <div class="remove-link" onclick="changeQty(${index}, -${item.qty})">Remove</div>
                </div>
                <div class="qty-controls">
                    <button class="qty-btn" onclick="changeQty(${index}, -1)">-</button>
                    <span>${item.qty}</span>
                    <button class="qty-btn" onclick="changeQty(${index}, 1)">+</button>
                </div>
                <div style="margin-left: 15px; font-weight: bold;">$${(item.price * item.qty).toFixed(2)}</div>
            </div>
        `).join('');
        updatePriceDisplay();
    }

    function updatePriceDisplay() {
        const itemTotal = cart.reduce((sum, i) => sum + (i.price * i.qty), 0);
        const shipFee = parseFloat(document.getElementById('shipRegion').value) || 0;
        document.getElementById('items-cost').innerText = `$${itemTotal.toFixed(2)}`;
        document.getElementById('ship-cost').innerText = `$${shipFee.toFixed(2)}`;
        document.getElementById('final-total').innerText = `$${(itemTotal + shipFee).toFixed(2)}`;
    }

    function toggleCart() { document.getElementById('cart-sidebar').classList.toggle('active'); }
    function openCheckout() { if(cart.length === 0) return alert("Cart is empty!"); document.getElementById('checkout-modal').style.display = 'flex'; updatePriceDisplay(); }
    function closeCheckout() { document.getElementById('checkout-modal').style.display = 'none'; }

    async function submitToSheet(type) {
        const payload = {
            Date: new Date().toLocaleString(),
            Type: type,
            Name: type === 'Request' ? document.getElementById('custName').value : document.getElementById('shipName').value,
            Phone: type === 'Request' ? document.getElementById('custPhone').value : document.getElementById('shipPhone').value,
            Details: type === 'Request' ? `Email: ${document.getElementById('custEmail').value} | Desc: ${document.getElementById('ideaDesc').value}` : `Address: ${document.getElementById('shipAddress').value}`,
            Items: cart.map(i => `${i.qty}x ${i.name}(${i.color})`).join(", "),
            Total: document.getElementById('final-total').innerText
        };

        try {
            await axios.post(SHEETDB_URL, payload);
            alert("Success! Check your inbox soonâ€”please be ready to answer emails or texts from us regarding your status.");
            if(type === 'Sale') { cart = []; updateCartUI(); closeCheckout(); toggleCart(); }
        } catch (e) { alert("Error connecting to database. Ensure YOUR_ID is correct."); }
    }

    function initPayPal() {
        paypal.Buttons({
            createOrder: (data, actions) => actions.order.create({
                purchase_units: [{ amount: { value: document.getElementById('final-total').innerText.replace('$', '') } }]
            }),
            onApprove: (data, actions) => actions.order.capture().then(() => submitToSheet('Sale'))
        }).render('#paypal-button-container');
    }
    init();
</script>
</body>
</html>